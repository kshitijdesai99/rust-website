"use strict";(self.webpackChunkant_design_pro=self.webpackChunkant_design_pro||[]).push([[880],{5880:function(ja,Ie,r){r.d(Ie,{Z:function(){return ta}});var Me=r(64599),ke=r.n(Me),Ve=r(19632),Ze=r.n(Ve),ze=r(15009),R=r.n(ze),Be=r(99289),L=r.n(Be),we=r(5574),E=r.n(we),X=r(2618),Le=r(90930),Ue=r(1413),Je=r(91),T=r(67294),Ke=r(21201),A=r(85893),Ye=["fieldProps","proFieldProps"],Ge=function(z,U){var J=z.fieldProps,K=z.proFieldProps,Y=(0,Je.Z)(z,Ye);return(0,A.jsx)(Ke.Z,(0,Ue.Z)({ref:U,valueType:"textarea",fieldProps:J,proFieldProps:K},Y))},Qe=T.forwardRef(Ge),He=r(5966),P=r(76772),Ce=r(53025),We=r(28036),Xe=r(29933),xe=r(82254),qe=r(66327),_e=r(96486),$=r.n(_e),me=r(34994),ea=r(64317),be=r(87200),aa=function(z){var U,J,K,Y,x,q,_,ee,ae,te,ne,re,le,ie,se,ra=z.breadcrumbTitle,D=z.editMode,la=(0,P.useModel)("@@initialState"),Ea=la.initialState,Te=(0,T.useRef)(),s=(0,T.useRef)(),O=(0,P.useParams)(),ia=(0,T.useState)({}),ge=E()(ia,2),N=ge[0],sa=ge[1],oa=(0,T.useState)([]),Se=E()(oa,2),M=Se[0],ua=Se[1],da=(0,T.useState)({}),Fe=E()(da,2),Pe=Fe[0],ca=Fe[1],va=(0,T.useState)([]),Oe=E()(va,2),pa=Oe[0],fa=Oe[1],ya=(0,T.useState)(!1),je=E()(ya,2),Ra=je[0],$a=je[1],ha=(0,T.useState)(),Ee=E()(ha,2),oe=Ee[0],ue=Ee[1],ma=Ce.Z.useForm(),ba=E()(ma,1),Aa=ba[0],Ta=(0,P.useSearchParams)(),Re=E()(Ta,2),Da=Re[0],Na=Re[1],G=(0,P.useLocation)(),ga=(0,T.useState)(),$e=E()(ga,2),Ia=$e[0],Sa=$e[1],Ma=(0,T.useRef)(),g=(U=G.state)===null||U===void 0?void 0:U.tableName,o=(J=G.state)===null||J===void 0?void 0:J.config,ka=(K=o==null||(Y=o.create)===null||Y===void 0?void 0:Y.enable)!==null&&K!==void 0?K:!1,Va=(x=o==null||(q=o.table)===null||q===void 0?void 0:q.page_size)!==null&&x!==void 0?x:20,Za=(_=o==null||(ee=o.table)===null||ee===void 0?void 0:ee.table_size)!==null&&_!==void 0?_:"middle",Fa=(ae=o==null||(te=o.update)===null||te===void 0?void 0:te.enable)!==null&&ae!==void 0?ae:!1;(0,T.useEffect)(function(){var e=function(){var t=L()(R()().mark(function l(){var p,c,m;return R()().wrap(function(v){for(;;)switch(v.prev=v.next){case 0:return v.next=2,(0,be.st)(g);case 2:return c=v.sent,m=(p=c.primary_key)!==null&&p!==void 0?p:[],ua(m),ca(c.cols),v.next=8,(0,P.request)("".concat("/api","/graphql"),{method:"POST",headers:(0,X.zl)(),data:{query:(0,xe.K)(),variables:{}}});case 8:return v.abrupt("return",v.sent);case 9:case"end":return v.stop()}},l)}));return function(){return t.apply(this,arguments)}}();e().then(function(t){var l=(0,qe.Z)(t.data),p=l.getQueryType().getFields();sa(p)})},[]),(0,T.useEffect)(function(){var e;if(!$().isEmpty(N)){var t=N[g].type.ofType.getFields().nodes.type.ofType.ofType.ofType.getFields(),l=(0,be.SS)(o,g,t,ue,Sa,Te,Pe);l.sort(function(p,c){return c.fieldOrder-p.fieldOrder}),fa(l),(e=Te.current)===null||e===void 0||e.reloadAndRest()}},[N]);function de(){return ce.apply(this,arguments)}function ce(){return ce=L()(R()().mark(function e(){var t,l,p,c;return R()().wrap(function(b){for(;;)switch(b.prev=b.next){case 0:if(t=function(){var v=L()(R()().mark(function f(){var a,u,h,i,y,S,F,V,n,B,Z,H,pe,j,C,fe,ye,he,w,Ne;return R()().wrap(function(d){for(;;)switch(d.prev=d.next){case 0:if(u=N[g].type.ofType.getFields().nodes.type.ofType.ofType.ofType.getFields(),h=Object.values(N[g].args).find(function(W){return W.name=="filters"}),i=(a=G.state)===null||a===void 0?void 0:a.record,y=[],S=[],i){d.next=7;break}return d.abrupt("return");case 7:F=ke()(M),d.prev=8,F.s();case 10:if((V=F.n()).done){d.next=21;break}if(n=V.value,!(i[n]===void 0||i[n].length<=0)){d.next=14;break}return d.abrupt("continue",19);case 14:B=h.type.getFields()[n],Z=B.type.getFields(),H=Object.values(Z).find(function(W){return W.name=="eq"}),pe=Object.values(Z).find(function(W){return W.name=="contains"}),pe!==void 0?y.push("".concat(n,': { contains: "').concat(i[n],'" }')):((j=Pe[n])===null||j===void 0?void 0:j.type)=="datetime"?y.push("".concat(n,': { between: ["').concat(i[n][0],' 00:00:00", "').concat(i[n][1],' 23:59:59"] }')):H.type.name=="Int"||H.type.name=="Boolean"?y.push("".concat(n,": { eq: ").concat(i[n]," }")):y.push("".concat(n,': { eq: "').concat(i[n],'" }'));case 19:d.next=10;break;case 21:d.next=26;break;case 23:d.prev=23,d.t0=d.catch(8),F.e(d.t0);case 26:return d.prev=26,F.f(),d.finish(26);case 29:d.t1=R()().keys(i);case 30:if((d.t2=d.t1()).done){d.next=38;break}if(C=d.t2.value,C!="_uuid_v4_"){d.next=34;break}return d.abrupt("continue",30);case 34:Ne=(fe=(ye=(he=u[C].type)===null||he===void 0?void 0:he._fields)!==null&&ye!==void 0?ye:(w=u[C].type)===null||w===void 0||(w=w.ofType)===null||w===void 0?void 0:w._fields)!==null&&fe!==void 0?fe:void 0,Ne===void 0&&S.push(C),d.next=30;break;case 38:return d.next=40,(0,P.request)("".concat("/api","/graphql"),{method:"POST",headers:(0,X.zl)(),data:{query:`
            query {
              `.concat(g,`(
                filters: { `).concat(y.join(", "),` }
              ) {
                nodes {
                  `).concat(S.join(", "),`
                }
              }
            }
          `),variables:{}}});case 40:return d.abrupt("return",d.sent);case 41:case"end":return d.stop()}},f,null,[[8,23,26,29]])}));return function(){return v.apply(this,arguments)}}(),!$().isEmpty(N)){b.next=5;break}return s==null||(l=s.current)===null||l===void 0||l.setFieldsValue((p=G.state)===null||p===void 0?void 0:p.record),ue((c=G.state)===null||c===void 0?void 0:c.record),b.abrupt("return");case 5:t().then(function(v){var f,a,u=(f=v==null||(a=v.data)===null||a===void 0||(a=a[g])===null||a===void 0?void 0:a.nodes)!==null&&f!==void 0?f:[];if(u.length>0){var h;s==null||(h=s.current)===null||h===void 0||h.setFieldsValue(u[0]),ue(u[0])}});case 6:case"end":return b.stop()}},e)})),ce.apply(this,arguments)}(0,T.useEffect)(function(){de()},[N]);var Pa=(0,T.useState)(""),Ae=E()(Pa,2),De=Ae[0],Oa=Ae[1];(0,T.useEffect)(function(){var e,t,l,p="",c=(e=o==null||(t=o.editor)===null||t===void 0?void 0:t.title_field)!==null&&e!==void 0?e:null;if(c&&s!==null&&s!==void 0&&(l=s.current)!==null&&l!==void 0&&l.getFieldsValue()[c]){var m;Oa(s==null||(m=s.current)===null||m===void 0?void 0:m.getFieldsValue()[c])}},[s==null||(ne=s.current)===null||ne===void 0?void 0:ne.getFieldsValue()]);var I=window.location.pathname.split("/"),Q=O!=null&&O.childTable?I[I.length-3]:I[I.length-2],k=O!=null&&O.childTable?I[I.length-4]:I[I.length-3],ve=o!=null&&o.childNavBar?"/".concat(g):"";return(0,A.jsx)(Le._z,{header:{title:null,breadcrumb:{items:[{href:"#",title:k=="table"?"Raw Tables":"Composite Tables",onClick:function(){return P.history.push("/".concat(k))}},{href:"#",title:(re=o==null||(le=o.table)===null||le===void 0?void 0:le.title)!==null&&re!==void 0?re:$().startCase(O.table),onClick:function(){return P.history.push("/".concat(k,"/").concat(Q))}},O!=null&&O.childTable?{href:"#",title:$().startCase(O==null?void 0:O.childTable),onClick:function(){return P.history.push("/".concat(k,"/").concat(Q))}}:{},{title:ra}]}},children:(0,A.jsx)(Xe.Z,{title:((ie=o==null||(se=o.table)===null||se===void 0?void 0:se.title)!==null&&ie!==void 0?ie:$().startCase(O.table))+(De?": ".concat(De):""),children:(0,A.jsx)(me.A,{layout:"vertical",grid:!0,rowProps:{gutter:1},formRef:s,submitter:D=="READONLY"?{resetButtonProps:{style:{display:"none"}},submitButtonProps:{style:{display:"none"}},render:function(t,l){return[].concat(Ze()(l),[Fa?(0,A.jsx)(We.ZP,{onClick:function(){P.history.push("/".concat(k,"/").concat(Q).concat(ve,"/update"),{config:o,tableName:g,record:oe})},children:"Update"}):null])}}:{resetButtonProps:{style:{display:"none"}}},onFinish:D=="UPDATE"?L()(R()().mark(function e(){var t,l,p,c,m,b,v,f,a,u,h,i,y,S,F;return R()().wrap(function(n){for(;;)switch(n.prev=n.next){case 0:t=[],l=[],p=N[g].type.ofType.getFields().nodes.type.ofType.ofType.ofType.getFields(),c=0,m=Object.entries(s==null||(b=s.current)===null||b===void 0?void 0:b.getFieldsValue());case 4:if(!(c<m.length)){n.next=19;break}if(f=E()(m[c],2),a=f[0],u=f[1],h=p[a],i=(v=h.type)===null||v===void 0?void 0:v.name,i===void 0&&(i=(y=h.type.ofType)===null||y===void 0?void 0:y.name),M.includes(a)&&(i==="Int"||i==="Float"||i==="Boolean"?l.push("".concat(a,": { eq: ").concat(u," }")):l.push("".concat(a,': { eq: "').concat(u,'" }'))),oe[a]!==u){n.next=12;break}return n.abrupt("continue",16);case 12:if(!(u!==!0&&u!==!1&&$().isEmpty(u))){n.next=15;break}return t.push("".concat(a,": null")),n.abrupt("continue",16);case 15:i=="Boolean"?t.push("".concat(a,": ").concat(JSON.stringify(u))):i=="Int"||i=="Float"?t.push("".concat(a,": ").concat(u)):u&&(a=="created_at"||a=="updated_at"||a=="created_date")?t.push("".concat(a,": ").concat(JSON.stringify(u.split(".")[0]))):t.push("".concat(a,": ").concat(JSON.stringify(u)));case 16:c++,n.next=4;break;case 19:return n.next=21,(0,P.request)("".concat("/api","/graphql"),{method:"POST",headers:(0,X.zl)(),data:{query:`
                      mutation {
                        `.concat(g,`_update(
                            data: {
                            `).concat(t.join(", "),`
                            }
                            filter: {
                            `).concat(l.join(`
`),`
                            }
                        ) {
                            `).concat(M.join(", "),`
                        }
                      }
                  `),variable:{}}});case 21:S=n.sent,$().isEmpty(S==null?void 0:S.errors)&&(de(),F=window.location.pathname.split("/"),P.history.push("/".concat(k,"/").concat(Q).concat(ve,"/view"),{config:o,tableName:g,record:oe}));case 23:case"end":return n.stop()}},e)})):D=="CREATE"?L()(R()().mark(function e(){var t,l,p,c,m,b,v,f,a,u,h,i,y,S,F,V,n,B,Z,H;return R()().wrap(function(j){for(;;)switch(j.prev=j.next){case 0:t=[],l=N[g].type.ofType.getFields().nodes.type.ofType.ofType.ofType.getFields(),p=0,c=Object.entries(s==null||(m=s.current)===null||m===void 0?void 0:m.getFieldsValue());case 3:if(!(p<c.length)){j.next=15;break}if(v=E()(c[p],2),f=v[0],a=v[1],u=l[f],h=(b=u.type)===null||b===void 0?void 0:b.name,h===void 0&&(h=(i=u.type.ofType)===null||i===void 0?void 0:i.name),!(a!==!0&&a!==!1&&$().isEmpty(a))){j.next=11;break}return t.push("".concat(f,": null")),j.abrupt("continue",12);case 11:h=="Boolean"||h=="Int"||h=="Float"?t.push("".concat(f,": ").concat(a)):a&&(f=="created_at"||f=="updated_at"||f=="created_date")?t.push("".concat(f,": ").concat(JSON.stringify(a.split(".")[0]))):t.push("".concat(f,": ").concat(JSON.stringify(a)));case 12:p++,j.next=3;break;case 15:return j.next=17,(0,P.request)("".concat("/api","/graphql"),{method:"POST",headers:(0,X.zl)(),data:{query:`
                      mutation {
                        `.concat(g,`_create_one(
                          data: {
                            `).concat(t.join(", "),`
                          }
                        ) {
                          `).concat(M.join(", "),`
                        }
                      }
                    `),variable:{}}});case 17:if(y=j.sent,$().isEmpty(y==null?void 0:y.errors)){n=(S=y==null||(F=y.data)===null||F===void 0?void 0:F["".concat(g,"_create_one")])!==null&&S!==void 0?S:{};for(B in n)s==null||(Z=s.current)===null||Z===void 0||Z.setFieldValue(B,n[B]);de(),H=window.location.pathname.split("/"),P.history.push("/".concat(k,"/").concat(Q).concat(ve,"/view"),{config:o,tableName:g,record:s==null||(V=s.current)===null||V===void 0?void 0:V.getFieldsValue()})}case 19:case"end":return j.stop()}},e)})):function(){},children:(0,A.jsx)(me.A.Group,{children:pa.filter(function(e){return!e.hideInUpdate}).map(function(e){if($().isEmpty(e.options)){var t;if(((t=e.fieldConfig)===null||t===void 0?void 0:t.input_type)=="textarea"){var l,p,c,m,b,v;return(0,A.jsx)(Qe,{colProps:{span:(l=(p=e.fieldConfig)===null||p===void 0?void 0:p.span)!==null&&l!==void 0?l:8},fieldProps:{rows:(c=(m=e.fieldConfig)===null||m===void 0?void 0:m.rows)!==null&&c!==void 0?c:3},name:e.dataIndex,label:(b=(v=e.fieldConfig)===null||v===void 0?void 0:v.title)!==null&&b!==void 0?b:e.title,placeholder:"",disabled:D=="READONLY"||D=="UPDATE"&&M.includes(e.dataIndex)},e.dataIndex)}else{var f,a,u,h;return(0,A.jsx)(He.Z,{colProps:{span:(f=(a=e.fieldConfig)===null||a===void 0?void 0:a.span)!==null&&f!==void 0?f:8},name:e.dataIndex,label:(u=(h=e.fieldConfig)===null||h===void 0?void 0:h.title)!==null&&u!==void 0?u:e.title,placeholder:"",disabled:D=="READONLY"||D=="UPDATE"&&M.includes(e.dataIndex)},e.dataIndex)}}else{var i,y,S,F;return(0,A.jsx)(ea.Z,{colProps:{span:(i=(y=e.fieldConfig)===null||y===void 0?void 0:y.span)!==null&&i!==void 0?i:8},name:e.dataIndex,label:(S=(F=e.fieldConfig)===null||F===void 0?void 0:F.title)!==null&&S!==void 0?S:e.title,options:e.options,disabled:D=="READONLY"||D=="UPDATE"&&M.includes(e.dataIndex)},e.dataIndex)}})})})})})},ta=aa}}]);
